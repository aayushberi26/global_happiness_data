<html>
<head>
<title>GDP</title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="//d3js.org/d3.v4.min.js"></script>
<style>
svg { border: solid #ccc 1px; }

</style>
</head>
<body>
<div id = "g2"></div>
<script>
var width = 960,
    height = 500;

var canvas2 = d3.select("#g2").append("canvas")
    .attr("width", width)
    .attr("height", height);

var context2 = canvas2.node().getContext("2d");

var projection2 = d3.geo.kavrayskiy7(),
    graticule2 = d3.geo.graticule();

var path2 = d3.geo.path()
    .projection(projection2)
    .context(context2);


context2.strokeStyle = '#636363';
context2.beginPath();
    path2(graticule2());
    context2.lineWidth = .1;
    context2.stroke();

context2.strokeStyle = '#969696';
context2.beginPath();
    path2(graticule2.outline());
    context2.lineWidth = .3;
    context2.stroke();


var gdpColors = ['#e5f5f9','#ccece6','#99d8c9','#66c2a4','#41ae76','#238b45','#006d2c','#00441b'];

function find_gdpcolor(id, data, gdp_map) {
   var colorid = 0;
   var gdp = 0;

   for (var i = 0; i < data.length; i++) {
        if (id == data[i].id) {
              gdp = gdp_map[i];
        }
   }
  
   if (gdp <= 5000) {
       colorid = 1;
   }
   if (gdp <= 20000 && gdp > 5000) {
       colorid = 2;
   }
   if (gdp <= 30000 && gdp > 20000) {
       colorid = 3;
   }
   if (gdp <= 40000 && gdp > 30000) {
       colorid = 4;
   }
   if (gdp <= 50000 && gdp > 40000) {
       colorid = 5;
   }
   if (gdp <= 60000 && gdp > 50000) {
       colorid = 6;
   }
   if (gdp > 60000) {
       colorid = 7;
   }

   return colorid;
}


d3.csv("data.csv", function(error, data) {
    if(error) { console.log(error); }
     var gdp_map = data.map(function (d) { return Number(d["GDP per capita ($)"]); }); 
   
   
d3.json("world-50m.json", function(error, world) {
   if (error) throw error;

   var countries = topojson.feature(world, world.objects.countries).features;
   
     countries.forEach(function(d, i) {
          colorid = find_gdpcolor(d.id, data, gdp_map);
          context2.fillStyle = gdpColors[colorid];
          context2.beginPath(); 
          path2(d); 
          context2.fill();
      });
  });
});

</script>
</body>
</html>