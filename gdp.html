<html>
<head>
<title>GDP</title>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<script src="//d3js.org/d3.v4.min.js"></script>
<style>
svg { border: solid #ccc 1px; }
</style>
</head>
<body>
<div id = "g2"></div>
<script>
var width = 960,
    height = 600;

var svg2 = d3.select("#g2").append("svg")
    .attr("width", width)
    .attr("height", height);

var projection = d3.geoEquirectangular();
var pathGenerator = d3.geoPath().projection(projection);


var gdpColors = ['#ccece6','#99d8c9','#66c2a4','#41ae76','#238b45','#006d2c','#00441b'];

var bars = [{"x": 150, "y": 550, "id": 0, text: "< 5"}, 
            {"x": 250, "y": 550, "id": 1, text: "5 - 15"}, 
            {"x": 350, "y": 550, "id": 2, text: "15 - 30"}, 
            {"x": 450, "y": 550, "id": 3, text: "30 - 45"},
            {"x": 550, "y": 550, "id": 4, text: "45 - 60"}, 
            {"x": 650, "y": 550, "id": 5, text: "60 - 75"}, 
            {"x": 750, "y": 550, "id": 6, text: "> 75"}];

bars.forEach(function(d) {
   svg2.append("rect")
      .attr("x", d.x)
      .attr("y", d.y)
      .attr("width", 100)
      .attr("height", 20)
      .style("fill", gdpColors[d.id]);

});
bars.forEach(function(d) {
   svg2.append("text")
      .style("font-size", "10pt")
      .style("font-family","Tahoma")
      .style("fill", gdpColors[d.id])
      .attr("x", d.x + 50)
      .attr("y", d.y + 40)
      .style("text-anchor", "middle")
      .text(d.text);

});
 svg2.append("text")
      .style("font-size", "7pt")
      .style("font-family","Tahoma")
      .style("fill", gdpColors[5])
      .attr("x", 100)
      .attr("y", 560)
      .style("text-anchor", "middle")
      .text("GDP per capita");
svg2.append("text")
      .style("font-size", "7pt")
      .style("font-family","Tahoma")
      .style("fill", gdpColors[5])
      .attr("x", 100)
      .attr("y", 570)
      .style("text-anchor", "middle")
      .text("(thousands $)");
var rawData;
var countries;
d3.csv("data.csv", function(error, data) {
    if(error) { console.log(error); }

     var gdp_map = data.map(function (d) { return Number(d["GDP per capita ($)"]); }); 
      
  d3.json("world-50m.json", function(error, world) {
    if (error) throw error;

    rawData = world;
    countries = topojson.feature(rawData, rawData.objects.countries);
    showGDPMap(data, gdp_map);
  });
});

function showGDPMap(data, gdp_map) {
  
  projection.fitExtent([[0,0], [svg2.attr("width"), svg2.attr("height")-10]], countries);
  pathGenerator = d3.geoPath().projection(projection);
  
  var paths = svg2.selectAll("path.country").data(countries.features);
  paths.enter().append("path")
  .attr("fill", function (country) {
    var colorid = find_gdpcolor(country.id, data, gdp_map);
    return gdpColors[colorid];
  })
  .merge(paths) 
  .attr("d", function (country) {
    return pathGenerator(country);
  });
}
function find_gdpcolor(id, data, gdp_map) {
   var colorid = 0;
   var gdp = 0;

   for (var i = 0; i < data.length; i++) {
        if (id == data[i].id) {
              gdp = gdp_map[i];
        }
   }  
     if (gdp <= 5000) {
        colorid = 1;
     }
     if (gdp <= 15000 && gdp > 5000) {
         colorid = 2;
     }
     if (gdp <= 30000 && gdp > 15000) {
       colorid = 3;
     }
     if (gdp <= 60000 && gdp > 45000) {
       colorid = 4;
     }
     if (gdp <= 75000 && gdp > 60000) {
       colorid = 5;
     }
     if (gdp > 75000) {
       colorid = 6;
     }
   return colorid;
}

</script>
</body>
</html>