<html>
<head>
<title>Happy</title>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="//d3js.org/d3.v4.min.js"></script>
<style>
svg { border: solid #ccc 1px; }

</style>
</head>
<body>
<div id = "g1"></div>
<script>
var width = 960,
    height = 500;

var canvas = d3.select("#g1").append("canvas")
    .attr("width", width)
    .attr("height", height);

var context = canvas.node().getContext("2d");

var projection = d3.geo.kavrayskiy7(),
    graticule = d3.geo.graticule();

var path = d3.geo.path()
    .projection(projection)
    .context(context);


context.strokeStyle = '#636363';
context.beginPath();
    path(graticule());
    context.lineWidth = .1;
    context.stroke();

context.strokeStyle = '#969696';
context.beginPath();
    path(graticule.outline());
    context.lineWidth = .3;
    context.stroke();

// the darker the color is, the higher happiness rank the coutry is
var happyColors = ['#fef0d9','#a63603','#e6550d','#fd8d3c','#fdae6b','#fdd0a2'];
function find_happycolor(id, ids) {
   var colorid = 0;
   for (var i = 0; i < 16; i++) {// 7-8
        if (id == ids[i]) {
             colorid = 1;
        }
   }
   for (var i = 16; i < 48; i++) { //6-7
        if (id == ids[i]) {
             colorid = 2;
        }
   }
   for (var i = 48; i < 100; i++) {//5-6
        if (id == ids[i]) {
             colorid = 3;
        }
   }
   for (var i = 100; i < 137; i++) {//4-5
        if (id == ids[i]) {
             colorid = 4;
        }
   }
   for (var i = 137; i < ids.length; i++) {//<4
        if (id == ids[i]) {
             colorid = 5;
        }
   }
   return colorid;
}

d3.csv("happy.csv", function(error, happy) {
    if(error) { console.log(error); }
    var ids = [];

    for (var i = 0; i < happy.length; i++) {
         ids.push(happy[i].id);
    }
  
d3.json("world-50m.json", function(error, world) {
   if (error) throw error;
   var countries = topojson.feature(world, world.objects.countries).features;
   
     countries.forEach(function(d, i) {
          colorid = find_happycolor(d.id, ids);
          context.fillStyle = happyColors[colorid];
          context.beginPath(); 
          path(d); 
          context.fill();
      });
  });
});


</script>
</body>
</html>